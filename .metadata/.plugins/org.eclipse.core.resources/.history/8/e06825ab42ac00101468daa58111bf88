<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
    <%@ taglib uri="jakarta.tags.core" prefix="c" %>
        <%@ taglib uri="jakarta.tags.fmt" prefix="fmt" %>
            <!DOCTYPE html>
            <html>

            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Qu·∫£n l√Ω ng∆∞·ªùi d√πng - ABC News</title>
                <link rel="stylesheet" href="${pageContext.request.contextPath}/assets/css/style.css">
                <link rel="stylesheet" href="${pageContext.request.contextPath}/assets/css/admin.css">
            </head>

            <body>
                <!-- Header -->
                <header class="admin-header">
                    <div class="container">
                        <div class="header-content">
                            <div class="logo">
                                <h1>ABC News - Qu·∫£n tr·ªã</h1>
                            </div>
                            <div class="user-info">
                                <span>Xin ch√†o, ${sessionScope.user.fullname}</span>
                                <a href="${pageContext.request.contextPath}/" class="btn-home">Trang ch·ªß</a>
                                <a href="${pageContext.request.contextPath}/logout" class="btn-logout">ƒêƒÉng xu·∫•t</a>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Admin Navigation -->
                <nav class="admin-nav">
                    <div class="container">
                        <ul class="admin-menu">
                            <li><a href="${pageContext.request.contextPath}/admin">Trang ch·ªß</a></li>
                            <li><a href="${pageContext.request.contextPath}/admin/news">Qu·∫£n l√Ω tin t·ª©c</a></li>
                            <li><a href="${pageContext.request.contextPath}/admin/categories">Qu·∫£n l√Ω lo·∫°i tin</a></li>
                            <li><a href="${pageContext.request.contextPath}/admin/users" class="active">Qu·∫£n l√Ω ng∆∞·ªùi
                                    d√πng</a></li>
                            <li><a href="${pageContext.request.contextPath}/admin/newsletters">Qu·∫£n l√Ω Newsletter</a>
                            </li>
                        </ul>
                    </div>
                </nav>

                <!-- Main Content -->
                <main class="admin-content">
                    <div class="container">
                        <div class="page-header">
                            <h2>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
                            <button type="button" class="btn-primary" onclick="showAddForm()">Th√™m ng∆∞·ªùi d√πng
                                m·ªõi</button>
                        </div>

                        <!-- Add/Edit User Form -->
                        <div id="userForm" class="form-container" style="display: none;">
                            <div class="form-header">
                                <h3 id="formTitle">Th√™m ng∆∞·ªùi d√πng m·ªõi</h3>
                                <button type="button" class="btn-close" onclick="hideForm()">√ó</button>
                            </div>
                            <form action="${pageContext.request.contextPath}/admin/users/save" method="post"
                                class="admin-form">
                                <input type="hidden" id="userId" name="id">

                                <div class="form-row">
                                    <div class="form-group half">
                                        <label for="username">T√™n ƒëƒÉng nh·∫≠p *</label>
                                        <input type="text" id="username" name="id" required maxlength="10"
                                            placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p...">
                                    </div>

                                    <div class="form-group half">
                                        <label for="fullname">H·ªç v√† t√™n *</label>
                                        <input type="text" id="fullname" name="fullname" required maxlength="40"
                                            placeholder="Nh·∫≠p h·ªç v√† t√™n...">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group half">
                                        <label for="email">Email *</label>
                                        <input type="email" id="email" name="email" required maxlength="30"
                                            placeholder="Nh·∫≠p email...">
                                    </div>

                                    <div class="form-group half">
                                        <label for="mobile">S·ªë ƒëi·ªán tho·∫°i</label>
                                        <input type="tel" id="mobile" name="mobile" maxlength="10"
                                            placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i...">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group half">
                                        <label for="password">M·∫≠t kh·∫©u *</label>
                                        <input type="password" id="password" name="password" required maxlength="50"
                                            placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
                                    </div>

                                    <div class="form-group half">
                                        <label for="birthday">Ng√†y sinh</label>
                                        <input type="date" id="birthday" name="birthday">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group half">
                                        <label for="gender">Gi·ªõi t√≠nh</label>
                                        <select id="gender" name="gender">
                                            <option value="">-- Ch·ªçn gi·ªõi t√≠nh --</option>
                                            <option value="1">Nam</option>
                                            <option value="0">N·ªØ</option>
                                        </select>
                                    </div>

                                    <div class="form-group half">
                                        <label for="role">Vai tr√≤ *</label>
                                        <select id="role" name="role" required>
                                            <option value="">-- Ch·ªçn vai tr√≤ --</option>
                                            <option value="1">Qu·∫£n tr·ªã vi√™n</option>
                                            <option value="0">Ph√≥ng vi√™n</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="submit" class="btn-primary" id="submitBtn">Th√™m m·ªõi</button>
                                    <button type="button" class="btn-secondary" onclick="hideForm()">H·ªßy</button>
                                </div>
                            </form>
                        </div>

                        <!-- Search and Filter -->
                        <div class="search-filter">
                            <form action="${pageContext.request.contextPath}/admin/users" method="get"
                                class="search-form">
                                <input type="text" name="search" placeholder="T√¨m ki·∫øm ng∆∞·ªùi d√πng..."
                                    value="${param.search}">
                                <select name="role">
                                    <option value="">T·∫•t c·∫£ vai tr√≤</option>
                                    <option value="1" <c:if test="${param.role == '1'}">selected</c:if>>Qu·∫£n tr·ªã vi√™n
                                    </option>
                                    <option value="0" <c:if test="${param.role == '0'}">selected</c:if>>Ph√≥ng vi√™n
                                    </option>
                                </select>
                                <button type="submit" class="btn-search">T√¨m ki·∫øm</button>
                            </form>
                        </div>

                        <!-- Users Table -->
                        <div class="data-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>T√™n ƒëƒÉng nh·∫≠p</th>
                                        <th>H·ªç v√† t√™n</th>
                                        <th>Email</th>
                                        <th>S·ªë ƒëi·ªán tho·∫°i</th>
                                        <th>Vai tr√≤</th>
                                        <th>Gi·ªõi t√≠nh</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <c:forEach var="user" items="${users}">
                                        <tr>
                                            <td>${user.id}</td>
                                            <td>${user.fullname}</td>
                                            <td>${user.email}</td>
                                            <td>${user.mobile}</td>
                                            <td>
                                                <c:choose>
                                                    <c:when test="${user.role == 1}">
                                                        <span class="badge badge-success">Qu·∫£n tr·ªã</span>
                                                    </c:when>
                                                    <c:otherwise>
                                                        <span class="badge badge-secondary">Ph√≥ng vi√™n</span>
                                                    </c:otherwise>
                                                </c:choose>
                                            </td>
                                            <td>
                                                <c:choose>
                                                    <c:when test="${user.gender == 1}">Nam</c:when>
                                                    <c:when test="${user.gender == 0}">N·ªØ</c:when>
                                                    <c:otherwise>-</c:otherwise>
                                                </c:choose>
                                            </td>
                                            <td class="actions">
                                                <button type="button" class="btn-edit"
                                                    onclick="editUser('${user.id}', '${user.fullname}', '${user.email}', '${user.mobile}', '${user.role}', '${user.gender}', '<fmt:formatDate value="
                                                    ${user.birthday}" pattern="yyyy-MM-dd" />')"
                                                title="S·ª≠a">‚úèÔ∏è</button>
                                                <c:if test="${user.id != sessionScope.user.id}">
                                                    <a href="${pageContext.request.contextPath}/admin/users/delete?id=${user.id}"
                                                        class="btn-delete" title="X√≥a"
                                                        onclick="return confirmDelete('${user.fullname}')">üóëÔ∏è</a>
                                                </c:if>
                                            </td>
                                        </tr>
                                    </c:forEach>
                                </tbody>
                            </table>
                        </div>

                        <c:if test="${empty users}">
                            <div class="empty-state">
                                <p>Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†o.</p>
                            </div>
                        </c:if>

                        <c:if test="${not empty message}">
                            <div class="message ${messageType}">
                                ${message}
                            </div>
                        </c:if>
                    </div>
                </main>

                <!-- Footer -->
                <footer class="admin-footer">
                    <div class="container">
                        <p>&copy; 2024 ABC News Admin Panel. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
                    </div>
                </footer>

                <script>
                    function showAddForm() {
                        document.getElementById('userForm').style.display = 'block';
                        document.getElementById('formTitle').textContent = 'Th√™m ng∆∞·ªùi d√πng m·ªõi';
                        document.getElementById('submitBtn').textContent = 'Th√™m m·ªõi';
                        clearForm();
                        document.getElementById('username').focus();
                    }

                    function editUser(id, fullname, email, mobile, role, gender, birthday) {
                        document.getElementById('userForm').style.display = 'block';
                        document.getElementById('formTitle').textContent = 'S·ª≠a th√¥ng tin ng∆∞·ªùi d√πng';
                        document.getElementById('submitBtn').textContent = 'C·∫≠p nh·∫≠t';

                        document.getElementById('userId').value = id;
                        document.getElementById('username').value = id;
                        document.getElementById('username').readOnly = true;
                        document.getElementById('fullname').value = fullname;
                        document.getElementById('email').value = email;
                        document.getElementById('mobile').value = mobile;
                        document.getElementById('role').value = role;
                        document.getElementById('gender').value = gender;
                        document.getElementById('birthday').value = birthday;
                        document.getElementById('password').required = false;
                        document.getElementById('password').placeholder = 'ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi m·∫≠t kh·∫©u';
                    }

                    function clearForm() {
                        document.getElementById('userId').value = '';
                        document.getElementById('username').value = '';
                        document.getElementById('username').readOnly = false;
                        document.getElementById('fullname').value = '';
                        document.getElementById('email').value = '';
                        document.getElementById('mobile').value = '';
                        document.getElementById('role').value = '';
                        document.getElementById('gender').value = '';
                        document.getElementById('birthday').value = '';
                        document.getElementById('password').required = true;
                        document.getElementById('password').placeholder = 'Nh·∫≠p m·∫≠t kh·∫©u...';
                    }

                    function hideForm() {
                        document.getElementById('userForm').style.display = 'none';
                    }

                    function confirmDelete(fullname) {
                        return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi d√πng "' + fullname + '"?');
                    }

                    // Form validation
                    document.querySelector('.admin-form').addEventListener('submit', function (e) {
                        const username = document.getElementById('username').value.trim();
                        const fullname = document.getElementById('fullname').value.trim();
                        const email = document.getElementById('email').value.trim();
                        const role = document.getElementById('role').value;

                        if (!username || !fullname || !email || !role) {
                            e.preventDefault();
                            alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!');
                        }
                    });
                </script>
            </body>

            </html>