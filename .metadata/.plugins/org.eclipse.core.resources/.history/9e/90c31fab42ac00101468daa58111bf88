<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.core" prefix="c" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω lo·∫°i tin - ABC News</title>
    <link rel="stylesheet" href="${pageContext.request.contextPath}/assets/css/style.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/assets/css/admin.css">
</head>
<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>ABC News - Qu·∫£n tr·ªã</h1>
                </div>
                <div class="user-info">
                    <span>Xin ch√†o, ${sessionScope.user.fullname}</span>
                    <a href="${pageContext.request.contextPath}/" class="btn-home">Trang ch·ªß</a>
                    <a href="${pageContext.request.contextPath}/logout" class="btn-logout">ƒêƒÉng xu·∫•t</a>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Admin Navigation -->
    <nav class="admin-nav">
        <div class="container">
            <ul class="admin-menu">
                <li><a href="${pageContext.request.contextPath}/admin">Trang ch·ªß</a></li>
                <li><a href="${pageContext.request.contextPath}/admin/news">Qu·∫£n l√Ω tin t·ª©c</a></li>
                <li><a href="${pageContext.request.contextPath}/admin/categories" class="active">Qu·∫£n l√Ω lo·∫°i tin</a></li>
                <li><a href="${pageContext.request.contextPath}/admin/users">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a></li>
                <li><a href="${pageContext.request.contextPath}/admin/newsletters">Qu·∫£n l√Ω Newsletter</a></li>
            </ul>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="admin-content">
        <div class="container">
            <div class="page-header">
                <h2>Qu·∫£n l√Ω lo·∫°i tin</h2>
                <button type="button" class="btn-primary" onclick="showAddForm()">Th√™m lo·∫°i tin m·ªõi</button>
            </div>
            
            <!-- Add/Edit Form -->
            <div id="categoryForm" class="form-container" style="display: none;">
                <div class="form-header">
                    <h3 id="formTitle">Th√™m lo·∫°i tin m·ªõi</h3>
                    <button type="button" class="btn-close" onclick="hideForm()">√ó</button>
                </div>
                <form action="${pageContext.request.contextPath}/admin/categories/save" method="post" class="admin-form">
                    <input type="hidden" id="categoryId" name="id">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categoryName">T√™n lo·∫°i tin *</label>
                            <input type="text" id="categoryName" name="name" required maxlength="50" 
                                   placeholder="Nh·∫≠p t√™n lo·∫°i tin...">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="submitBtn">Th√™m m·ªõi</button>
                        <button type="button" class="btn-secondary" onclick="hideForm()">H·ªßy</button>
                    </div>
                </form>
            </div>
            
            <!-- Categories Table -->
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n lo·∫°i tin</th>
                            <th>S·ªë l∆∞·ª£ng tin</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        <c:forEach var="category" items="${categories}">
                            <tr>
                                <td>${category.id}</td>
                                <td>${category.name}</td>
                                <td>${category.newsCount}</td>
                                <td class="actions">
                                    <button type="button" class="btn-edit" 
                                            onclick="editCategory('${category.id}', '${category.name}')" 
                                            title="S·ª≠a">‚úèÔ∏è</button>
                                    <a href="${pageContext.request.contextPath}/admin/categories/delete?id=${category.id}" 
                                       class="btn-delete" title="X√≥a" 
                                       onclick="return confirmDelete('${category.name}')">üóëÔ∏è</a>
                                </td>
                            </tr>
                        </c:forEach>
                    </tbody>
                </table>
            </div>
            
            <c:if test="${empty categories}">
                <div class="empty-state">
                    <p>Ch∆∞a c√≥ lo·∫°i tin n√†o. H√£y th√™m lo·∫°i tin ƒë·∫ßu ti√™n!</p>
                </div>
            </c:if>
            
            <c:if test="${not empty message}">
                <div class="message ${messageType}">
                    ${message}
                </div>
            </c:if>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="admin-footer">
        <div class="container">
            <p>&copy; 2024 ABC News Admin Panel. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        </div>
    </footer>
    
    <script>
        function showAddForm() {
            document.getElementById('categoryForm').style.display = 'block';
            document.getElementById('formTitle').textContent = 'Th√™m lo·∫°i tin m·ªõi';
            document.getElementById('submitBtn').textContent = 'Th√™m m·ªõi';
            document.getElementById('categoryId').value = '';
            document.getElementById('categoryName').value = '';
            document.getElementById('categoryName').focus();
        }
        
        function editCategory(id, name) {
            document.getElementById('categoryForm').style.display = 'block';
            document.getElementById('formTitle').textContent = 'S·ª≠a lo·∫°i tin';
            document.getElementById('submitBtn').textContent = 'C·∫≠p nh·∫≠t';
            document.getElementById('categoryId').value = id;
            document.getElementById('categoryName').value = name;
            document.getElementById('categoryName').focus();
        }
        
        function hideForm() {
            document.getElementById('categoryForm').style.display = 'none';
        }
        
        function confirmDelete(categoryName) {
            return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a lo·∫°i tin "' + categoryName + '"?\nL∆∞u √Ω: T·∫•t c·∫£ tin t·ª©c thu·ªôc lo·∫°i n√†y s·∫Ω b·ªã ·∫£nh h∆∞·ªüng.');
        }
        
        // Form validation
        document.querySelector('.admin-form').addEventListener('submit', function(e) {
            const name = document.getElementById('categoryName').value.trim();
            if (!name) {
                e.preventDefault();
                alert('Vui l√≤ng nh·∫≠p t√™n lo·∫°i tin!');
            }
        });
    </script>
</body>
</html>